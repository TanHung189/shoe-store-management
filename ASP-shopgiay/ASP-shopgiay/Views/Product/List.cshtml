@model ASP_shopgiay.ViewModels.ProductListViewModel

@{
    ViewData["Title"] = "Danh Sách Sản Phẩm";
    Layout = null; // Tạm thời bỏ Layout để xem full trang
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Shop Giày Sneaker</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        @@media (min-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @@media (min-width: 1024px) {
            .product-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-4">
            <a href="/" class="text-xl font-black text-indigo-700 hover:text-indigo-900 transition">&larr; Trở về Trang Chủ</a>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-extrabold text-gray-800 mb-8">Danh Sách Sản Phẩm</h1>

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Sidebar Bộ lọc (Filters) -->
            <aside class="lg:w-1/4 bg-white p-6 rounded-xl shadow-lg h-full lg:sticky top-20">
                <h3 class="text-xl font-bold text-gray-800 mb-5 border-b pb-3">Bộ Lọc Sản Phẩm</h3>

                <!-- Lọc theo Danh mục -->
                <div class="mb-6">
                    <h4 class="font-semibold text-lg mb-3 text-indigo-600">Danh Mục</h4>
                    <ul>
                        <li>
                            <a href="@Url.Action("List", "Product")"
                               class="block py-1 text-gray-600 hover:text-indigo-500 @(Model.CurrentCategoryId == null ? "font-bold text-indigo-700" : "")">
                                Tất cả (@Model.Products.Count)
                            </a>
                        </li>
                        @foreach (var dm in Model.AllCategories.Where(c => c.ParentId == null))
                        {
                            <li class="mt-2">
                                <a href="@Url.Action("List", "Product", new { categoryId = dm.MaDm, brandId = Model.CurrentBrandId })"
                                   class="block font-semibold text-gray-700 hover:text-indigo-600 @(Model.CurrentCategoryId == dm.MaDm ? "text-indigo-700" : "")">
                                    @dm.Ten
                                </a>
                                @* Hiển thị danh mục con *@
                                @if (Model.AllCategories.Any(c => c.ParentId == dm.MaDm))
                                {
                                    <ul class="ml-4 border-l pl-3 border-gray-200 mt-1">
                                        @foreach (var dmCon in Model.AllCategories.Where(c => c.ParentId == dm.MaDm))
                                        {
                                            <li>
                                                <a href="@Url.Action("List", "Product", new { categoryId = dmCon.MaDm, brandId = Model.CurrentBrandId })"
                                                   class="block text-sm text-gray-500 hover:text-indigo-600 @(Model.CurrentCategoryId == dmCon.MaDm ? "font-semibold text-indigo-700" : "")">
                                                    - @dmCon.Ten
                                                </a>
                                            </li>
                                        }
                                    </ul>
                                }
                            </li>
                        }
                    </ul>
                </div>

                <!-- Lọc theo Thương hiệu -->
                <div class="mb-6">
                    <h4 class="font-semibold text-lg mb-3 text-indigo-600">Thương Hiệu</h4>
                    <ul>
                        @foreach (var th in Model.AllBrands)
                        {
                            <li>
                                <a href="@Url.Action("List", "Product", new { brandId = th.MaTh, categoryId = Model.CurrentCategoryId })"
                                   class="block py-1 text-gray-600 hover:text-indigo-500 @(Model.CurrentBrandId == th.MaTh ? "font-bold text-indigo-700" : "")">
                                    @th.TenTh
                                </a>
                            </li>
                        }
                    </ul>
                </div>

            </aside>

            <!-- Nội dung Sản phẩm (Product Grid) -->
            <section class="lg:w-3/4">
                <div class="product-grid">
                    @if (Model.Products.Any())
                    {
                        @foreach (var product in Model.Products)
                        {
                            @* Sử dụng Partial View để render thẻ sản phẩm *@
                            <partial name="_ProductCard" model="product" />
                        }
                    }
                    else
                    {
                        <div class="col-span-full bg-white p-10 rounded-xl shadow-lg text-center text-gray-500">
                            Không tìm thấy sản phẩm nào phù hợp với bộ lọc.
                        </div>
                    }
                </div>

                <!-- Phân trang (Pagination) -->
                @if (Model.TotalPages > 1)
                {
                    <div class="flex justify-center items-center space-x-2 mt-8">
                        @{
                            // Hàm helper đơn giản để giữ lại các tham số truy vấn hiện tại
                            string GetPaginationUrl(int pageNum)
                            {
                                var routeValues = new RouteValueDictionary {
                                        { "categoryId", Model.CurrentCategoryId },
                                        { "brandId", Model.CurrentBrandId },
                                        { "page", pageNum }
                                        };
                                return Url.Action("List", "Product", routeValues) ?? "#";
                            }
                        }

                        <!-- Nút Previous -->
                        <a href="@(Model.CurrentPage > 1 ? GetPaginationUrl(Model.CurrentPage - 1) : "#")"
                           class="px-3 py-2 rounded-lg @(Model.CurrentPage > 1 ? "bg-indigo-500 text-white hover:bg-indigo-600" : "bg-gray-300 text-gray-500 cursor-not-allowed")">
                            &laquo; Trước
                        </a>

                        <!-- Các trang -->
                        @for (int i = 1; i <= Model.TotalPages; i++)
                        {
                            <a href="@GetPaginationUrl(i)"
                               class="px-3 py-2 rounded-lg font-semibold @(i == Model.CurrentPage ? "bg-indigo-700 text-white shadow-lg" : "bg-white text-indigo-600 hover:bg-indigo-100")">
                                @i
                            </a>
                        }

                        <!-- Nút Next -->
                        <a href="@(Model.CurrentPage<Model.TotalPages? GetPaginationUrl(Model.CurrentPage + 1) : "#")"
                           class="px-3 py-2 rounded-lg @(Model.CurrentPage < Model.TotalPages ? "bg-indigo-500 text-white hover:bg-indigo-600" : "bg-gray-300 text-gray-500 cursor-not-allowed")">
                            Tiếp &raquo;
                        </a>
                    </div>
                }
            </section>
        </div>
    </main>

    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-4 py-8 text-center">
            <p>&copy; @DateTime.Now.Year ShopGiay. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>